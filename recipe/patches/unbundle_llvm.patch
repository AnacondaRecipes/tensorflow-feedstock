commit 510c285f2ad0c4294a26730474e042742fd53454
Author: Isuru Fernando <isuruf@gmail.com>
Date:   Thu Aug 15 02:50:37 2019 +0000

    Unbundle LLVM

diff --git a/tensorflow/workspace.bzl b/tensorflow/workspace.bzl
index dff151246a..ad183bdcf9 100755
--- a/tensorflow/workspace.bzl
+++ b/tensorflow/workspace.bzl
@@ -498,6 +498,7 @@ def tf_workspace(path_prefix = "", tf_repo_name = ""):
     tf_http_archive(
         name = "llvm",
         build_file = clean_dep("//third_party/llvm:llvm.autogenerated.BUILD"),
+        system_build_file = clean_dep("//third_party/systemlibs:llvm.BUILD"),
         sha256 = "54c715a4aba9a337d5c44b04153f75fc196045b213ea8ee5e79b58465d700532",
         strip_prefix = "llvm-558b52b517b8c989dc2d7fffb5c580fa45aece34",
         urls = [
diff --git a/third_party/systemlibs/generate_llvm_build.py b/third_party/systemlibs/generate_llvm_build.py
new file mode 100644
index 0000000000..77070d3e28
--- /dev/null
+++ b/third_party/systemlibs/generate_llvm_build.py
@@ -0,0 +1,321 @@
+# Bazel BUILD file generator for system LLVM.
+
+import os
+
+llvm_libs = [
+    "AArch64AsmParser",
+    "AArch64AsmPrinter",
+    "AArch64CodeGen",
+    "AArch64Desc",
+    "AArch64Disassembler",
+    "AArch64Info",
+    "AArch64Utils",
+    "AggressiveInstCombine",
+    "AMDGPUAsmParser",
+    "AMDGPUAsmPrinter",
+    "AMDGPUCodeGen",
+    "AMDGPUDesc",
+    "AMDGPUDisassembler",
+    "AMDGPUInfo",
+    "AMDGPUUtils",
+    "Analysis",
+    "ARMAsmParser",
+    "ARMAsmPrinter",
+    "ARMCodeGen",
+    "ARMDesc",
+    "ARMDisassembler",
+    "ARMInfo",
+    "ARMUtils",
+    "AsmParser",
+    "AsmPrinter",
+    "AVRAsmParser",
+    "AVRCodeGen",
+    "AVRDesc",
+    "AVRDisassembler",
+    "AVRInfo",
+    "BinaryFormat",
+    "BitReader",
+    "BitstreamReader",
+    "BitWriter",
+    "BPFAsmParser",
+    "BPFAsmPrinter",
+    "BPFCodeGen",
+    "BPFDesc",
+    "BPFDisassembler",
+    "BPFInfo",
+    "CodeGen",
+    "Core",
+    "Coroutines",
+    "Coverage",
+    "DebugInfoCodeView",
+    "DebugInfoDWARF",
+    "DebugInfoGSYM",
+    "DebugInfoMSF",
+    "DebugInfoPDB",
+    "Demangle",
+    "DlltoolDriver",
+    "ExecutionEngine",
+    "FuzzMutate",
+    "GlobalISel",
+    "HexagonAsmParser",
+    "HexagonCodeGen",
+    "HexagonDesc",
+    "HexagonDisassembler",
+    "HexagonInfo",
+    "InstCombine",
+    "Instrumentation",
+    "IntelJITEvents",
+    "Interpreter",
+    "ipo",
+    "IRReader",
+    "JITLink",
+    "LanaiAsmParser",
+    "LanaiAsmPrinter",
+    "LanaiCodeGen",
+    "LanaiDesc",
+    "LanaiDisassembler",
+    "LanaiInfo",
+    "LibDriver",
+    "LineEditor",
+    "Linker",
+    "LTO",
+    "MC",
+    "MCA",
+    "MCDisassembler",
+    "MCJIT",
+    "MCParser",
+    "MipsAsmParser",
+    "MipsAsmPrinter",
+    "MipsCodeGen",
+    "MipsDesc",
+    "MipsDisassembler",
+    "MipsInfo",
+    "MIRParser",
+    "MSP430AsmParser",
+    "MSP430AsmPrinter",
+    "MSP430CodeGen",
+    "MSP430Desc",
+    "MSP430Disassembler",
+    "MSP430Info",
+    "NVPTXAsmPrinter",
+    "NVPTXCodeGen",
+    "NVPTXDesc",
+    "NVPTXInfo",
+    "ObjCARCOpts",
+    "Object",
+    "ObjectYAML",
+    "Option",
+    "OptRemarks",
+    "OrcJIT",
+    "Passes",
+    "PowerPCAsmParser",
+    "PowerPCAsmPrinter",
+    "PowerPCCodeGen",
+    "PowerPCDesc",
+    "PowerPCDisassembler",
+    "PowerPCInfo",
+    "ProfileData",
+    "Remarks",
+    "RISCVAsmParser",
+    "RISCVCodeGen",
+    "RISCVDesc",
+    "RISCVDisassembler",
+    "RISCVInfo",
+    "RISCVUtils",
+    "RuntimeDyld",
+    "ScalarOpts",
+    "SelectionDAG",
+    "SparcAsmParser",
+    "SparcAsmPrinter",
+    "SparcCodeGen",
+    "SparcDesc",
+    "SparcDisassembler",
+    "SparcInfo",
+    "Support",
+    "Symbolize",
+    "SystemZAsmParser",
+    "SystemZAsmPrinter",
+    "SystemZCodeGen",
+    "SystemZDesc",
+    "SystemZDisassembler",
+    "SystemZInfo",
+    "TableGen",
+    "Target",
+    "TestingSupport",
+    "TextAPI",
+    "TransformUtils",
+    "Vectorize",
+    "WebAssemblyAsmParser",
+    "WebAssemblyAsmPrinter",
+    "WebAssemblyCodeGen",
+    "WebAssemblyDesc",
+    "WebAssemblyDisassembler",
+    "WebAssemblyInfo",
+    "WindowsManifest",
+    "X86AsmParser",
+    "X86AsmPrinter",
+    "X86CodeGen",
+    "X86Desc",
+    "X86Disassembler",
+    "X86Info",
+    "X86Utils",
+    "XCoreAsmPrinter",
+    "XCoreCodeGen",
+    "XCoreDesc",
+    "XCoreDisassembler",
+    "XCoreInfo",
+    "XRay"
+]
+
+def process_name(name):
+  if name.endswith("Opts"):
+    return name[:-4].lower()
+  return name.lower()
+
+llvm_libs_dict = dict((process_name(name), name) for name in llvm_libs)
+
+llvm_libs_dict["scalar"] = "ScalarOpts"
+
+
+INIT_TEXT = """
+# Bazel BUILD file for system LLVM
+#
+# Auto-generated by generate_llvm_build.py
+
+licenses(["notice"])
+
+filegroup(
+    name = "LICENSE.TXT",
+    visibility = ["//visibility:public"],
+)
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+
+# Binary targets used by Tensorflow.
+genrule(
+    name = "lnllvmtblgenlink",
+    outs = ["llvmtblgenlink"],
+    cmd = "ln -s $$(which llvm-tblgen) $@",
+)
+
+sh_binary(
+    name = "llvm-tblgen",
+    srcs = ["llvmtblgenlink"],
+    visibility = ["//visibility:public"],
+)
+
+genrule(
+    name = "lnfilecheck",
+    outs = ["filechecklink"],
+    cmd = "ln -s $$(which FileCheck) $@",
+)
+
+sh_binary(
+    name = "FileCheck",
+    srcs = ["filechecklink"],
+    visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "config",
+   defines = llvm_defines,
+   visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "x86_defs",
+   visibility = ["//visibility:public"],
+   deps = [
+       ":config",
+   ]
+)
+"""
+
+skipped_deps = [
+    ":attributes_compat_gen",
+    ":attributes_gen",
+    ":intrinsic_enums_gen",
+    ":intrinsics_impl_gen",
+    ":aarch64_target_gen",
+    ":x86_target_gen",
+    ":arm_target_gen",
+    ":instcombine_transforms_gen",
+]
+
+def cc_library(**kwargs):
+  name = kwargs.get("name")
+  if name in ["config", "x86_defs", "gtest", "gtest_main"]:
+    return
+  libname = name
+  if libname.startswith("arc_"):
+    libname = "sp" + libname
+  libname = llvm_libs_dict.get(libname.replace("_", ""), name)
+  deps = kwargs.get("deps", [])
+  deps = [d for d in deps if d not in skipped_deps]
+  if not deps:
+    print(f"""
+cc_library(
+    name = "{name}",
+    linkopts = ["-lLLVM{libname}"],
+    visibility = ["//visibility:public"],
+)""")
+  else:
+    deps_line = "\",\n        \"".join(deps)
+    print(f"""
+cc_library(
+    name = "{name}",
+    linkopts = ["-lLLVM{libname}"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "{deps_line}",
+    ],
+)""")
+
+def glob(*args, **kwargs):     # pylint: disable=unused-argument
+  return []
+
+
+def genrule(*args, **kwargs):  # pylint: disable=unused-argument
+  pass
+
+llvm_support_platform_specific_srcs_glob = glob
+licenses = exports_files = load = package = expand_cmake_vars = genrule
+py_binary = template_rule = gentbl = cc_binary = filegroup = genrule
+llvm_copts = llvm_all_cmake_vars = llvm_defines = llvm_linkopts = []
+
+licenses(["notice"])
+
+exports_files(["LICENSE.TXT"])
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+load(
+    "@org_tensorflow//third_party:common.bzl",
+    "template_rule",
+)
+
+third_party_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
+build_path = os.path.join(third_party_dir, "llvm", "llvm.autogenerated.BUILD")
+
+print(INIT_TEXT)
+with open(build_path, "r") as f:
+  exec(f.read())
diff --git a/third_party/systemlibs/llvm.BUILD b/third_party/systemlibs/llvm.BUILD
new file mode 100644
index 0000000000..c6e9b9b1f2
--- /dev/null
+++ b/third_party/systemlibs/llvm.BUILD
@@ -0,0 +1,1089 @@
+
+# Bazel BUILD file for system LLVM
+#
+# Auto-generated by generate_llvm_build.py
+
+licenses(["notice"])
+
+filegroup(
+    name = "LICENSE.TXT",
+    visibility = ["//visibility:public"],
+)
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+
+# Binary targets used by Tensorflow.
+genrule(
+    name = "lnllvmtblgenlink",
+    outs = ["llvmtblgenlink"],
+    cmd = "ln -s $$(which llvm-tblgen) $@",
+)
+
+sh_binary(
+    name = "llvm-tblgen",
+    srcs = ["llvmtblgenlink"],
+    visibility = ["//visibility:public"],
+)
+
+genrule(
+    name = "lnfilecheck",
+    outs = ["filechecklink"],
+    cmd = "ln -s $$(which FileCheck) $@",
+)
+
+sh_binary(
+    name = "FileCheck",
+    srcs = ["filechecklink"],
+    visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "config",
+   defines = llvm_defines,
+   visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "x86_defs",
+   visibility = ["//visibility:public"],
+   deps = [
+       ":config",
+   ]
+)
+
+
+cc_library(
+    name = "aarch64_asm_parser",
+    linkopts = ["-lLLVMAArch64AsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_asm_printer",
+    linkopts = ["-lLLVMAArch64AsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_code_gen",
+    linkopts = ["-lLLVMAArch64CodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_asm_printer",
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "aarch64_desc",
+    linkopts = ["-lLLVMAArch64Desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_asm_printer",
+        ":aarch64_info",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_disassembler",
+    linkopts = ["-lLLVMAArch64Disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_info",
+    linkopts = ["-lLLVMAArch64Info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":code_gen",
+        ":config",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "aarch64_utils",
+    linkopts = ["-lLLVMAArch64Utils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aggressive_inst_combine",
+    linkopts = ["-lLLVMAggressiveInstCombine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "analysis",
+    linkopts = ["-lLLVMAnalysis"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":core",
+        ":object",
+        ":profile_data",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_desc",
+    linkopts = ["-lLLVMAMDGPUDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_asm_printer",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_disassembler",
+    linkopts = ["-lLLVMAMDGPUDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_info",
+    linkopts = ["-lLLVMAMDGPUInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_r600_target_gen",
+        ":amdgpu_target_gen",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_utils",
+    linkopts = ["-lLLVMAMDGPUUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_r600_target_gen",
+        ":amdgpu_target_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_asm_parser",
+    linkopts = ["-lLLVMAMDGPUAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_asm_printer",
+    linkopts = ["-lLLVMAMDGPUAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_utils",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_code_gen",
+    linkopts = ["-lLLVMAMDGPUCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_asm_printer",
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":ipo",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "arm_asm_parser",
+    linkopts = ["-lLLVMARMAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_asm_printer",
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_asm_printer",
+    linkopts = ["-lLLVMARMAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_code_gen",
+    linkopts = ["-lLLVMARMCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":arm_asm_printer",
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "arm_desc",
+    linkopts = ["-lLLVMARMDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_asm_printer",
+        ":arm_info",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_disassembler",
+    linkopts = ["-lLLVMARMDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_info",
+    linkopts = ["-lLLVMARMInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "arm_utils",
+    linkopts = ["-lLLVMARMUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "asm_parser",
+    linkopts = ["-lLLVMAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "asm_printer",
+    linkopts = ["-lLLVMAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":binary_format",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":debug_info_code_view",
+        ":debug_info_msf",
+        ":mc",
+        ":mc_parser",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "binary_format",
+    linkopts = ["-lLLVMBinaryFormat"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bit_reader",
+    linkopts = ["-lLLVMBitReader"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bit_writer",
+    linkopts = ["-lLLVMBitWriter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "code_gen",
+    linkopts = ["-lLLVMCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":config",
+        ":core",
+        ":instrumentation",
+        ":mc",
+        ":profile_data",
+        ":scalar",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "core",
+    linkopts = ["-lLLVMCore"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_code_view",
+    linkopts = ["-lLLVMDebugInfoCodeView"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":debug_info_msf",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_msf",
+    linkopts = ["-lLLVMDebugInfoMSF"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "demangle",
+    linkopts = ["-lLLVMDemangle"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+    ],
+)
+
+cc_library(
+    name = "execution_engine",
+    linkopts = ["-lLLVMExecutionEngine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":mc",
+        ":object",
+        ":runtime_dyld",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "global_i_sel",
+    linkopts = ["-lLLVMGlobalISel"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "instrumentation",
+    linkopts = ["-lLLVMInstrumentation"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":profile_data",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "inst_combine",
+    linkopts = ["-lLLVMInstCombine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "ipo",
+    linkopts = ["-lLLVMipo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":instrumentation",
+        ":ir_reader",
+        ":linker",
+        ":object",
+        ":profile_data",
+        ":scalar",
+        ":support",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "ir_reader",
+    linkopts = ["-lLLVMIRReader"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_parser",
+        ":bit_reader",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "linker",
+    linkopts = ["-lLLVMLinker"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "mc",
+    linkopts = ["-lLLVMMC"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":debug_info_code_view",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mc_disassembler",
+    linkopts = ["-lLLVMMCDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mc_parser",
+    linkopts = ["-lLLVMMCParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "nvptx_asm_printer",
+    linkopts = ["-lLLVMNVPTXAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "nvptx_target_gen",
+        ":config",
+        ":mc",
+        ":nvptx_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "nvptx_code_gen",
+    linkopts = ["-lLLVMNVPTXCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":ipo",
+        ":mc",
+        ":nvptx_asm_printer",
+        ":nvptx_desc",
+        ":nvptx_info",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "nvptx_desc",
+    linkopts = ["-lLLVMNVPTXDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "nvptx_target_gen",
+        ":config",
+        ":mc",
+        ":nvptx_asm_printer",
+        ":nvptx_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "nvptx_info",
+    linkopts = ["-lLLVMNVPTXInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "nvptx_target_gen",
+        ":config",
+        ":core",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "object",
+    linkopts = ["-lLLVMObject"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":bit_reader",
+        ":config",
+        ":core",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "objc_arc",
+    linkopts = ["-lLLVMObjCARCOpts"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "orc_jit",
+    linkopts = ["-lLLVMOrcJIT"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":execution_engine",
+        ":mc",
+        ":object",
+        ":runtime_dyld",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "powerpc_asm_parser",
+    linkopts = ["-lLLVMPowerPCAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":powerpc_desc",
+        ":powerpc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_asm_printer",
+    linkopts = ["-lLLVMPowerPCAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":powerpc_info",
+        ":powerpc_target_gen",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_code_gen",
+    linkopts = ["-lLLVMPowerPCCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":powerpc_asm_printer",
+        ":powerpc_desc",
+        ":powerpc_info",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "powerpc_desc",
+    linkopts = ["-lLLVMPowerPCDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":powerpc_asm_printer",
+        ":powerpc_info",
+        ":powerpc_target_gen",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_disassembler",
+    linkopts = ["-lLLVMPowerPCDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":powerpc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_info",
+    linkopts = ["-lLLVMPowerPCInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":powerpc_target_gen",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "profile_data",
+    linkopts = ["-lLLVMProfileData"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "runtime_dyld",
+    linkopts = ["-lLLVMRuntimeDyld"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "scalar",
+    linkopts = ["-lLLVMScalarOpts"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "selection_dag",
+    linkopts = ["-lLLVMSelectionDAG"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "support",
+    linkopts = ["-lLLVMSupport"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":demangle",
+        "@zlib_archive//:zlib",
+    ],
+)
+
+cc_library(
+    name = "table_gen",
+    linkopts = ["-lLLVMTableGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "target",
+    linkopts = ["-lLLVMTarget"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "transform_utils",
+    linkopts = ["-lLLVMTransformUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "vectorize",
+    linkopts = ["-lLLVMVectorize"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":scalar",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "x86_asm_parser",
+    linkopts = ["-lLLVMX86AsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+        ":x86_asm_printer",
+        ":x86_desc",
+        ":x86_info",
+    ],
+)
+
+cc_library(
+    name = "x86_asm_printer",
+    linkopts = ["-lLLVMX86AsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+        ":x86_info",
+        ":x86_utils",
+    ],
+)
+
+cc_library(
+    name = "x86_code_gen",
+    linkopts = ["-lLLVMX86CodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":profile_data",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":x86_asm_printer",
+        ":x86_defs",
+        ":x86_desc",
+        ":x86_info",
+        ":x86_utils",
+    ],
+)
+
+cc_library(
+    name = "x86_desc",
+    linkopts = ["-lLLVMX86Desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":object",
+        ":support",
+        ":x86_asm_printer",
+        ":x86_info",
+    ],
+)
+
+cc_library(
+    name = "x86_disassembler",
+    linkopts = ["-lLLVMX86Disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":support",
+        ":x86_info",
+    ],
+)
+
+cc_library(
+    name = "x86_info",
+    linkopts = ["-lLLVMX86Info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "x86_utils",
+    linkopts = ["-lLLVMX86Utils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":code_gen",
+        ":config",
+        ":support",
+    ],
+)
diff --git a/third_party/systemlibs/syslibs_configure.bzl b/third_party/systemlibs/syslibs_configure.bzl
index 1b971eca8a..0a61242cf6 100644
--- a/third_party/systemlibs/syslibs_configure.bzl
+++ b/third_party/systemlibs/syslibs_configure.bzl
@@ -29,6 +29,7 @@ VALID_LIBS = [
     "jpeg",
     "jsoncpp_git",
     "keras_applications_archive",
+    "llvm",
     "lmdb",
     "nasm",
     "nsync",
