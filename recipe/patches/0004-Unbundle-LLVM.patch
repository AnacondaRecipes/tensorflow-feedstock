From b56de6090f7f1e8818b55d2d5e669696dde19f23 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Thu, 15 Aug 2019 02:50:37 +0000
Subject: [PATCH 4/4] Unbundle LLVM

---
 tensorflow/workspace.bzl                      |    1 +
 third_party/systemlibs/generate_llvm_build.py |  301 +++
 third_party/systemlibs/llvm.BUILD             | 2122 +++++++++++++++++
 third_party/systemlibs/syslibs_configure.bzl  |    1 +
 4 files changed, 2425 insertions(+)
 create mode 100644 third_party/systemlibs/generate_llvm_build.py
 create mode 100644 third_party/systemlibs/llvm.BUILD

diff --git a/tensorflow/workspace.bzl b/tensorflow/workspace.bzl
index 262da77e0c2..9824c6c7b68 100755
--- a/tensorflow/workspace.bzl
+++ b/tensorflow/workspace.bzl
@@ -612,6 +612,7 @@ def tf_repositories(path_prefix = "", tf_repo_name = ""):
         name = "llvm-project",
         sha256 = LLVM_SHA256,
         strip_prefix = "llvm-project-" + LLVM_COMMIT,
+        system_build_file = clean_dep("//third_party/systemlibs:llvm.BUILD"),
         urls = LLVM_URLS,
         additional_build_files = {
             clean_dep("//third_party/llvm:llvm.autogenerated.BUILD"): "llvm/BUILD",
diff --git a/third_party/systemlibs/generate_llvm_build.py b/third_party/systemlibs/generate_llvm_build.py
new file mode 100644
index 00000000000..54745b46f10
--- /dev/null
+++ b/third_party/systemlibs/generate_llvm_build.py
@@ -0,0 +1,301 @@
+# Bazel BUILD file generator for system LLVM.
+
+import os
+
+llvm_libs = [
+    "AArch64AsmParser",
+    "AArch64CodeGen",
+    "AArch64Desc",
+    "AArch64Disassembler",
+    "AArch64Info",
+    "AArch64Utils",
+    "AggressiveInstCombine",
+    "AMDGPUAsmParser",
+    "AMDGPUCodeGen",
+    "AMDGPUDesc",
+    "AMDGPUDisassembler",
+    "AMDGPUInfo",
+    "AMDGPUUtils",
+    "Analysis",
+    "ARMAsmParser",
+    "ARMCodeGen",
+    "ARMDesc",
+    "ARMDisassembler",
+    "ARMInfo",
+    "ARMUtils",
+    "AsmParser",
+    "AsmPrinter",
+    "BinaryFormat",
+    "BitReader",
+    "BitstreamReader",
+    "BitWriter",
+    "BPFAsmParser",
+    "BPFCodeGen",
+    "BPFDesc",
+    "BPFDisassembler",
+    "BPFInfo",
+    "CodeGen",
+    "Core",
+    "Coroutines",
+    "Coverage",
+    "DebugInfoCodeView",
+    "DebugInfoDWARF",
+    "DebugInfoGSYM",
+    "DebugInfoMSF",
+    "DebugInfoPDB",
+    "Demangle",
+    "DlltoolDriver",
+    "ExecutionEngine",
+    "FuzzMutate",
+    "GlobalISel",
+    "HexagonAsmParser",
+    "HexagonCodeGen",
+    "HexagonDesc",
+    "HexagonDisassembler",
+    "HexagonInfo",
+    "InstCombine",
+    "Instrumentation",
+    "IntelJITEvents",
+    "Interpreter",
+    "ipo",
+    "IRReader",
+    "JITLink",
+    "LanaiAsmParser",
+    "LanaiCodeGen",
+    "LanaiDesc",
+    "LanaiDisassembler",
+    "LanaiInfo",
+    "LibDriver",
+    "LineEditor",
+    "Linker",
+    "LTO",
+    "MC",
+    "MCA",
+    "MCDisassembler",
+    "MCJIT",
+    "MCParser",
+    "MipsAsmParser",
+    "MipsCodeGen",
+    "MipsDesc",
+    "MipsDisassembler",
+    "MipsInfo",
+    "MIRParser",
+    "MSP430AsmParser",
+    "MSP430CodeGen",
+    "MSP430Desc",
+    "MSP430Disassembler",
+    "MSP430Info",
+    "NVPTXCodeGen",
+    "NVPTXDesc",
+    "NVPTXInfo",
+    "ObjCARCOpts",
+    "Object",
+    "ObjectYAML",
+    "Option",
+    "OrcJIT",
+    "Passes",
+    "PowerPCAsmParser",
+    "PowerPCCodeGen",
+    "PowerPCDesc",
+    "PowerPCDisassembler",
+    "PowerPCInfo",
+    "ProfileData",
+    "Remarks",
+    "RISCVAsmParser",
+    "RISCVCodeGen",
+    "RISCVDesc",
+    "RISCVDisassembler",
+    "RISCVInfo",
+    "RISCVUtils",
+    "RuntimeDyld",
+    "ScalarOpts",
+    "SelectionDAG",
+    "SparcAsmParser",
+    "SparcCodeGen",
+    "SparcDesc",
+    "SparcDisassembler",
+    "SparcInfo",
+    "Support",
+    "Symbolize",
+    "SystemZAsmParser",
+    "SystemZAsmPrinter",
+    "SystemZCodeGen",
+    "SystemZDesc",
+    "SystemZDisassembler",
+    "SystemZInfo",
+    "TableGen",
+    "Target",
+    "TextAPI",
+    "TransformUtils",
+    "Vectorize",
+    "WebAssemblyAsmParser",
+    "WebAssemblyCodeGen",
+    "WebAssemblyDesc",
+    "WebAssemblyDisassembler",
+    "WebAssemblyInfo",
+    "WindowsManifest",
+    "X86AsmParser",
+    "X86CodeGen",
+    "X86Desc",
+    "X86Disassembler",
+    "X86Info",
+    "X86Utils",
+    "XCoreCodeGen",
+    "XCoreDesc",
+    "XCoreDisassembler",
+    "XCoreInfo",
+    "XRay"
+]
+
+def process_name(name):
+  if name.endswith("Opts"):
+    return name[:-4].lower()
+  return name.lower()
+
+llvm_libs_dict = dict((process_name(name), name) for name in llvm_libs)
+
+llvm_libs_dict["scalar"] = "ScalarOpts"
+
+
+INIT_TEXT = """
+# Bazel BUILD file for system LLVM
+#
+# Auto-generated by generate_llvm_build.py
+
+licenses(["notice"])
+
+filegroup(
+    name = "LICENSE.TXT",
+    visibility = ["//visibility:public"],
+)
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+
+# Binary targets used by Tensorflow.
+genrule(
+    name = "lnllvmtblgenlink",
+    outs = ["llvmtblgenlink"],
+    cmd = "ln -s $$(which llvm-tblgen) $@",
+)
+
+sh_binary(
+    name = "llvm-tblgen",
+    srcs = ["llvmtblgenlink"],
+    visibility = ["//visibility:public"],
+)
+
+genrule(
+    name = "lnfilecheck",
+    outs = ["filechecklink"],
+    cmd = "ln -s $$(which FileCheck) $@",
+)
+
+sh_binary(
+    name = "FileCheck",
+    srcs = ["filechecklink"],
+    visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "config",
+   defines = llvm_defines,
+   visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "x86_defs",
+   visibility = ["//visibility:public"],
+   deps = [
+       ":config",
+   ]
+)
+"""
+
+skipped_deps = [
+    ":attributes_compat_gen",
+    ":attributes_gen",
+    ":intrinsic_enums_gen",
+    ":intrinsics_impl_gen",
+    ":aarch64_target_gen",
+    ":x86_target_gen",
+    ":arm_target_gen",
+    ":instcombine_transforms_gen",
+]
+
+def cc_library(**kwargs):
+  name = kwargs.get("name")
+  if name in ["config", "x86_defs", "gtest", "gtest_main"]:
+    return
+  libname = name
+  if libname.startswith("arc_"):
+    libname = "sp" + libname
+  libname = llvm_libs_dict.get(libname.replace("_", ""), name)
+  deps = kwargs.get("deps", [])
+  deps = [d for d in deps if d not in skipped_deps]
+  if not deps:
+    print(f"""
+cc_library(
+    name = "{name}",
+    linkopts = ["-lLLVM{libname}"],
+    visibility = ["//visibility:public"],
+)""")
+  else:
+    deps_line = "\",\n        \"".join(deps)
+    print(f"""
+cc_library(
+    name = "{name}",
+    linkopts = ["-lLLVM{libname}"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "{deps_line}",
+    ],
+)""")
+
+def glob(*args, **kwargs):     # pylint: disable=unused-argument
+  return []
+
+
+def genrule(*args, **kwargs):  # pylint: disable=unused-argument
+  pass
+
+llvm_support_platform_specific_srcs_glob = glob
+licenses = exports_files = load = package = expand_cmake_vars = genrule
+py_binary = template_rule = gentbl = cc_binary = filegroup = genrule
+llvm_copts = llvm_all_cmake_vars = llvm_defines = llvm_linkopts = []
+
+licenses(["notice"])
+
+exports_files(["LICENSE.TXT"])
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+load(
+    "@org_tensorflow//third_party:common.bzl",
+    "template_rule",
+)
+
+third_party_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
+build_path = os.path.join(third_party_dir, "llvm", "llvm.autogenerated.BUILD")
+
+print(INIT_TEXT)
+with open(build_path, "r") as f:
+  exec(f.read())
diff --git a/third_party/systemlibs/llvm.BUILD b/third_party/systemlibs/llvm.BUILD
new file mode 100644
index 00000000000..909684a445c
--- /dev/null
+++ b/third_party/systemlibs/llvm.BUILD
@@ -0,0 +1,2122 @@
+
+# Bazel BUILD file for system LLVM
+#
+# Auto-generated by generate_llvm_build.py
+
+licenses(["notice"])
+
+filegroup(
+    name = "LICENSE.TXT",
+    visibility = ["//visibility:public"],
+)
+
+load(
+    "@org_tensorflow//third_party/llvm:llvm.bzl",
+    "cmake_var_string",
+    "expand_cmake_vars",
+    "gentbl",
+    "llvm_all_cmake_vars",
+    "llvm_copts",
+    "llvm_defines",
+    "llvm_linkopts",
+    "llvm_support_platform_specific_srcs_glob",
+)
+
+# Binary targets used by Tensorflow.
+genrule(
+    name = "lnllvmtblgenlink",
+    outs = ["llvmtblgenlink"],
+    cmd = "ln -s $$(which llvm-tblgen) $@",
+)
+
+sh_binary(
+    name = "llvm-tblgen",
+    srcs = ["llvmtblgenlink"],
+    visibility = ["//visibility:public"],
+)
+
+genrule(
+    name = "lnfilecheck",
+    outs = ["filechecklink"],
+    cmd = "ln -s $$(which FileCheck) $@",
+)
+
+sh_binary(
+    name = "FileCheck",
+    srcs = ["filechecklink"],
+    visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "config",
+   defines = llvm_defines,
+   visibility = ["//visibility:public"],
+)
+
+cc_library(
+   name = "x86_defs",
+   visibility = ["//visibility:public"],
+   deps = [
+       ":config",
+   ]
+)
+
+
+cc_library(
+    name = "aarch64_asm_parser",
+    linkopts = ["-lLLVMAArch64AsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_code_gen",
+    linkopts = ["-lLLVMAArch64CodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "aarch64_desc",
+    linkopts = ["-lLLVMAArch64Desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_disassembler",
+    linkopts = ["-lLLVMAArch64Disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aarch64_desc",
+        ":aarch64_info",
+        ":aarch64_utils",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aarch64_info",
+    linkopts = ["-lLLVMAArch64Info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":code_gen",
+        ":config",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "aarch64_utils",
+    linkopts = ["-lLLVMAArch64Utils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "aggressive_inst_combine",
+    linkopts = ["-lLLVMAggressiveInstCombine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "analysis",
+    linkopts = ["-lLLVMAnalysis"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":core",
+        ":object",
+        ":profile_data",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_desc",
+    linkopts = ["-lLLVMAMDGPUDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":binary_format",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_disassembler",
+    linkopts = ["-lLLVMAMDGPUDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_info",
+    linkopts = ["-lLLVMAMDGPUInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_r600_target_gen",
+        ":amdgpu_target_gen",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_utils",
+    linkopts = ["-lLLVMAMDGPUUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_r600_target_gen",
+        ":amdgpu_target_gen",
+        ":binary_format",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_asm_parser",
+    linkopts = ["-lLLVMAMDGPUAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "amdgpu_code_gen",
+    linkopts = ["-lLLVMAMDGPUCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":amdgpu_desc",
+        ":amdgpu_info",
+        ":amdgpu_utils",
+        ":analysis",
+        ":asm_printer",
+        ":binary_format",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":ipo",
+        ":mc",
+        ":mir_parser",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "arc_code_gen",
+    linkopts = ["-lLLVMSparcCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":arc_desc",
+        ":arc_info",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "arc_desc",
+    linkopts = ["-lLLVMSparcDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arc_info",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arc_disassembler",
+    linkopts = ["-lLLVMSparcDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arc_info",
+        ":config",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arc_info",
+    linkopts = ["-lLLVMSparcInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_asm_parser",
+    linkopts = ["-lLLVMARMAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_code_gen",
+    linkopts = ["-lLLVMARMCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "arm_desc",
+    linkopts = ["-lLLVMARMDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_disassembler",
+    linkopts = ["-lLLVMARMDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":arm_desc",
+        ":arm_info",
+        ":arm_utils",
+        ":config",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "arm_info",
+    linkopts = ["-lLLVMARMInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "arm_utils",
+    linkopts = ["-lLLVMARMUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "avr_asm_parser",
+    linkopts = ["-lLLVMavr_asm_parser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":avr_desc",
+        ":avr_info",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "avr_code_gen",
+    linkopts = ["-lLLVMavr_code_gen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_printer",
+        ":avr_desc",
+        ":avr_info",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "avr_desc",
+    linkopts = ["-lLLVMavr_desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":avr_info",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "avr_disassembler",
+    linkopts = ["-lLLVMavr_disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":avr_info",
+        ":config",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "avr_info",
+    linkopts = ["-lLLVMavr_info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "asm_parser",
+    linkopts = ["-lLLVMAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "asm_printer",
+    linkopts = ["-lLLVMAsmPrinter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":binary_format",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":debug_info_code_view",
+        ":debug_info_dwarf",
+        ":debug_info_msf",
+        ":mc",
+        ":mc_parser",
+        ":remarks",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "bpf_asm_parser",
+    linkopts = ["-lLLVMBPFAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":bpf_desc",
+        ":bpf_info",
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bpf_code_gen",
+    linkopts = ["-lLLVMBPFCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_printer",
+        ":bpf_desc",
+        ":bpf_info",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "bpf_desc",
+    linkopts = ["-lLLVMBPFDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":bpf_info",
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bpf_disassembler",
+    linkopts = ["-lLLVMBPFDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":bpf_info",
+        ":config",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bpf_info",
+    linkopts = ["-lLLVMBPFInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "binary_format",
+    linkopts = ["-lLLVMBinaryFormat"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bit_reader",
+    linkopts = ["-lLLVMBitReader"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "bit_writer",
+    linkopts = ["-lLLVMBitWriter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "code_gen",
+    linkopts = ["-lLLVMCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":config",
+        ":core",
+        ":instrumentation",
+        ":mc",
+        ":profile_data",
+        ":scalar",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "core",
+    linkopts = ["-lLLVMCore"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":remarks",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "coroutines",
+    linkopts = ["-lLLVMCoroutines"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":ipo",
+        ":scalar",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "coverage",
+    linkopts = ["-lLLVMCoverage"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":object",
+        ":profile_data",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_code_view",
+    linkopts = ["-lLLVMDebugInfoCodeView"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":debug_info_msf",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_dwarf",
+    linkopts = ["-lLLVMDebugInfoDWARF"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":mc",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_msf",
+    linkopts = ["-lLLVMDebugInfoMSF"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "debug_info_pdb",
+    linkopts = ["-lLLVMDebugInfoPDB"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":debug_info_code_view",
+        ":debug_info_msf",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "demangle",
+    linkopts = ["-lLLVMDemangle"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+    ],
+)
+
+cc_library(
+    name = "dlltool_driver",
+    linkopts = ["-lLLVMDlltoolDriver"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":object",
+        ":option",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "execution_engine",
+    linkopts = ["-lLLVMExecutionEngine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":mc",
+        ":object",
+        ":runtime_dyld",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "fuzz_mutate",
+    linkopts = ["-lLLVMFuzzMutate"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":config",
+        ":core",
+        ":scalar",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "global_i_sel",
+    linkopts = ["-lLLVMGlobalISel"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "instrumentation",
+    linkopts = ["-lLLVMInstrumentation"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":profile_data",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "inst_combine",
+    linkopts = ["-lLLVMInstCombine"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "interpreter",
+    linkopts = ["-lLLVMInterpreter"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":code_gen",
+        ":config",
+        ":core",
+        ":execution_engine",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "hexagon_asm_parser",
+    linkopts = ["-lLLVMHexagonAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":hexagon_desc",
+        ":hexagon_info",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "hexagon_code_gen",
+    linkopts = ["-lLLVMHexagonCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":hexagon_asm_parser",
+        ":hexagon_desc",
+        ":hexagon_info",
+        ":ipo",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "hexagon_desc",
+    linkopts = ["-lLLVMHexagonDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":hexagon_info",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "hexagon_disassembler",
+    linkopts = ["-lLLVMHexagonDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":hexagon_desc",
+        ":hexagon_info",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "hexagon_info",
+    linkopts = ["-lLLVMHexagonInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "ipo",
+    linkopts = ["-lLLVMipo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":instrumentation",
+        ":ir_reader",
+        ":linker",
+        ":object",
+        ":profile_data",
+        ":scalar",
+        ":support",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "ir_reader",
+    linkopts = ["-lLLVMIRReader"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_parser",
+        ":bit_reader",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "jit_link",
+    linkopts = ["-lLLVMJITLink"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "lto",
+    linkopts = ["-lLLVMLTO"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":bit_reader",
+        ":bit_writer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":ipo",
+        ":linker",
+        ":mc",
+        ":objc_arc",
+        ":object",
+        ":passes",
+        ":scalar",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "lanai_asm_parser",
+    linkopts = ["-lLLVMLanaiAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":lanai_desc",
+        ":lanai_info",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "lanai_code_gen",
+    linkopts = ["-lLLVMLanaiCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":lanai_asm_parser",
+        ":lanai_desc",
+        ":lanai_info",
+        ":mc",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "lanai_desc",
+    linkopts = ["-lLLVMLanaiDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":lanai_info",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "lanai_disassembler",
+    linkopts = ["-lLLVMLanaiDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":lanai_desc",
+        ":lanai_info",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "lanai_info",
+    linkopts = ["-lLLVMLanaiInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "lib_driver",
+    linkopts = ["-lLLVMLibDriver"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":object",
+        ":option",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "line_editor",
+    linkopts = ["-lLLVMLineEditor"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "linker",
+    linkopts = ["-lLLVMLinker"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "mc",
+    linkopts = ["-lLLVMMC"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":debug_info_code_view",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mca",
+    linkopts = ["-lLLVMMCA"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mc_disassembler",
+    linkopts = ["-lLLVMMCDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mcjit",
+    linkopts = ["-lLLVMMCJIT"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":execution_engine",
+        ":object",
+        ":runtime_dyld",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "mc_parser",
+    linkopts = ["-lLLVMMCParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mir_parser",
+    linkopts = ["-lLLVMMIRParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_parser",
+        ":binary_format",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "msp430_asm_parser",
+    linkopts = ["-lLLVMMSP430AsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":msp430_desc",
+        ":msp430_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "msp430_code_gen",
+    linkopts = ["-lLLVMMSP430CodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":msp430_desc",
+        ":msp430_info",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "msp430_desc",
+    linkopts = ["-lLLVMMSP430Desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":msp430_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "msp430_disassembler",
+    linkopts = ["-lLLVMMSP430Disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":msp430_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "msp430_info",
+    linkopts = ["-lLLVMMSP430Info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mips_asm_parser",
+    linkopts = ["-lLLVMMipsAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":mips_desc",
+        ":mips_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mips_code_gen",
+    linkopts = ["-lLLVMMipsCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":mips_desc",
+        ":mips_info",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "mips_desc",
+    linkopts = ["-lLLVMMipsDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mips_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mips_disassembler",
+    linkopts = ["-lLLVMMipsDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":mips_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "mips_info",
+    linkopts = ["-lLLVMMipsInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "nvptx_code_gen",
+    linkopts = ["-lLLVMNVPTXCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":ipo",
+        ":mc",
+        ":nvptx_desc",
+        ":nvptx_info",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "nvptx_desc",
+    linkopts = ["-lLLVMNVPTXDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "nvptx_target_gen",
+        ":config",
+        ":mc",
+        ":nvptx_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "nvptx_info",
+    linkopts = ["-lLLVMNVPTXInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        "nvptx_target_gen",
+        ":config",
+        ":core",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "object",
+    linkopts = ["-lLLVMObject"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":bit_reader",
+        ":config",
+        ":core",
+        ":mc",
+        ":mc_parser",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "objc_arc",
+    linkopts = ["-lLLVMObjCARCOpts"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "object_yaml",
+    linkopts = ["-lLLVMObjectYAML"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":debug_info_code_view",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "option",
+    linkopts = ["-lLLVMOption"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "orc_jit",
+    linkopts = ["-lLLVMOrcJIT"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":execution_engine",
+        ":jit_link",
+        ":mc",
+        ":object",
+        ":runtime_dyld",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "passes",
+    linkopts = ["-lLLVMPasses"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":instrumentation",
+        ":ipo",
+        ":scalar",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":vectorize",
+    ],
+)
+
+cc_library(
+    name = "powerpc_asm_parser",
+    linkopts = ["-lLLVMPowerPCAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":powerpc_desc",
+        ":powerpc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_code_gen",
+    linkopts = ["-lLLVMPowerPCCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":powerpc_desc",
+        ":powerpc_info",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "powerpc_desc",
+    linkopts = ["-lLLVMPowerPCDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":powerpc_info",
+        ":powerpc_target_gen",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_disassembler",
+    linkopts = ["-lLLVMPowerPCDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":powerpc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "powerpc_info",
+    linkopts = ["-lLLVMPowerPCInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":powerpc_target_gen",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "profile_data",
+    linkopts = ["-lLLVMProfileData"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "riscv_asm_parser",
+    linkopts = ["-lLLVMRISCVAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":riscv_desc",
+        ":riscv_info",
+        ":riscv_utils",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "riscv_code_gen",
+    linkopts = ["-lLLVMRISCVCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":riscv_desc",
+        ":riscv_info",
+        ":riscv_utils",
+        ":selection_dag",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "riscv_desc",
+    linkopts = ["-lLLVMRISCVDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":riscv_info",
+        ":riscv_utils",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "riscv_disassembler",
+    linkopts = ["-lLLVMRISCVDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":riscv_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "riscv_info",
+    linkopts = ["-lLLVMRISCVInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "riscv_utils",
+    linkopts = ["-lLLVMRISCVUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "remarks",
+    linkopts = ["-lLLVMRemarks"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "runtime_dyld",
+    linkopts = ["-lLLVMRuntimeDyld"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "scalar",
+    linkopts = ["-lLLVMScalarOpts"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":aggressive_inst_combine",
+        ":analysis",
+        ":config",
+        ":core",
+        ":inst_combine",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "selection_dag",
+    linkopts = ["-lLLVMSelectionDAG"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+        ":target",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "sparc_asm_parser",
+    linkopts = ["-lLLVMSparcAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":sparc_desc",
+        ":sparc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "sparc_code_gen",
+    linkopts = ["-lLLVMSparcCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":selection_dag",
+        ":sparc_desc",
+        ":sparc_info",
+        ":support",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "sparc_desc",
+    linkopts = ["-lLLVMSparcDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":sparc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "sparc_disassembler",
+    linkopts = ["-lLLVMSparcDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":sparc_info",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "sparc_info",
+    linkopts = ["-lLLVMSparcInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "support",
+    linkopts = ["-lLLVMSupport"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":demangle",
+        "@zlib_archive//:zlib",
+    ],
+)
+
+cc_library(
+    name = "symbolize",
+    linkopts = ["-lLLVMSymbolize"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":debug_info_dwarf",
+        ":debug_info_pdb",
+        ":demangle",
+        ":object",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "system_z_asm_parser",
+    linkopts = ["-lLLVMSystemZAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+        ":system_z_desc",
+        ":system_z_info",
+    ],
+)
+
+cc_library(
+    name = "system_z_code_gen",
+    linkopts = ["-lLLVMSystemZCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":system_z_desc",
+        ":system_z_info",
+        ":target",
+    ],
+)
+
+cc_library(
+    name = "system_z_desc",
+    linkopts = ["-lLLVMSystemZDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+        ":system_z_info",
+    ],
+)
+
+cc_library(
+    name = "system_z_disassembler",
+    linkopts = ["-lLLVMSystemZDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":support",
+        ":system_z_desc",
+        ":system_z_info",
+    ],
+)
+
+cc_library(
+    name = "system_z_info",
+    linkopts = ["-lLLVMSystemZInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "table_gen",
+    linkopts = ["-lLLVMTableGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "target",
+    linkopts = ["-lLLVMTarget"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "testing_support",
+    linkopts = ["-lLLVMtesting_support"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "text_api",
+    linkopts = ["-lLLVMTextAPI"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":binary_format",
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "transform_utils",
+    linkopts = ["-lLLVMTransformUtils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "vectorize",
+    linkopts = ["-lLLVMVectorize"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":config",
+        ":core",
+        ":scalar",
+        ":support",
+        ":transform_utils",
+    ],
+)
+
+cc_library(
+    name = "web_assembly_asm_parser",
+    linkopts = ["-lLLVMWebAssemblyAsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+        ":web_assembly_info",
+    ],
+)
+
+cc_library(
+    name = "web_assembly_code_gen",
+    linkopts = ["-lLLVMWebAssemblyCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":binary_format",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":scalar",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":web_assembly_desc",
+        ":web_assembly_info",
+    ],
+)
+
+cc_library(
+    name = "web_assembly_desc",
+    linkopts = ["-lLLVMWebAssemblyDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+        ":web_assembly_info",
+    ],
+)
+
+cc_library(
+    name = "web_assembly_disassembler",
+    linkopts = ["-lLLVMWebAssemblyDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":support",
+        ":web_assembly_desc",
+        ":web_assembly_info",
+    ],
+)
+
+cc_library(
+    name = "web_assembly_info",
+    linkopts = ["-lLLVMWebAssemblyInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "windows_manifest",
+    linkopts = ["-lLLVMWindowsManifest"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "x86_asm_parser",
+    linkopts = ["-lLLVMX86AsmParser"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_parser",
+        ":support",
+        ":x86_desc",
+        ":x86_info",
+    ],
+)
+
+cc_library(
+    name = "x86_code_gen",
+    linkopts = ["-lLLVMX86CodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":global_i_sel",
+        ":mc",
+        ":profile_data",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":x86_defs",
+        ":x86_desc",
+        ":x86_info",
+        ":x86_utils",
+    ],
+)
+
+cc_library(
+    name = "x86_desc",
+    linkopts = ["-lLLVMX86Desc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":mc_disassembler",
+        ":object",
+        ":support",
+        ":x86_info",
+        ":x86_utils",
+    ],
+)
+
+cc_library(
+    name = "x86_disassembler",
+    linkopts = ["-lLLVMX86Disassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":support",
+        ":x86_info",
+    ],
+)
+
+cc_library(
+    name = "x86_info",
+    linkopts = ["-lLLVMX86Info"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "x86_utils",
+    linkopts = ["-lLLVMX86Utils"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":code_gen",
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "x_core_code_gen",
+    linkopts = ["-lLLVMXCoreCodeGen"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":analysis",
+        ":asm_printer",
+        ":code_gen",
+        ":config",
+        ":core",
+        ":mc",
+        ":selection_dag",
+        ":support",
+        ":target",
+        ":transform_utils",
+        ":x_core_desc",
+        ":x_core_info",
+    ],
+)
+
+cc_library(
+    name = "x_core_desc",
+    linkopts = ["-lLLVMXCoreDesc"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc",
+        ":support",
+        ":x_core_info",
+    ],
+)
+
+cc_library(
+    name = "x_core_disassembler",
+    linkopts = ["-lLLVMXCoreDisassembler"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":mc_disassembler",
+        ":support",
+        ":x_core_info",
+    ],
+)
+
+cc_library(
+    name = "x_core_info",
+    linkopts = ["-lLLVMXCoreInfo"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":support",
+    ],
+)
+
+cc_library(
+    name = "x_ray",
+    linkopts = ["-lLLVMXRay"],
+    visibility = ["//visibility:public"],
+    deps = [
+        ":config",
+        ":object",
+        ":support",
+    ],
+)
diff --git a/third_party/systemlibs/syslibs_configure.bzl b/third_party/systemlibs/syslibs_configure.bzl
index 217c0131186..9e89523266a 100644
--- a/third_party/systemlibs/syslibs_configure.bzl
+++ b/third_party/systemlibs/syslibs_configure.bzl
@@ -30,6 +30,7 @@ VALID_LIBS = [
     "icu",
     "jsoncpp_git",
     "libjpeg_turbo",
+    "llvm",
     "lmdb",
     "nasm",
     "nsync",
-- 
2.29.2.windows.3

