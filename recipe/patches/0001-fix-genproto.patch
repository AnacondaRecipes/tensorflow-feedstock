From 0c40777a10c23448a2508944a04f26d022d1664e Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Thu, 16 Nov 2023 06:38:27 +0000
Subject: [PATCH] fix genproto

---
 third_party/systemlibs/protobuf.BUILD                        | 2 +-
 .../third_party/tsl/tsl/platform/default/build_config.bzl    | 5 +----
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/third_party/systemlibs/protobuf.BUILD b/third_party/systemlibs/protobuf.BUILD
index a7a066bc..aec4df34 100644
--- a/third_party/systemlibs/protobuf.BUILD
+++ b/third_party/systemlibs/protobuf.BUILD
@@ -80,7 +80,7 @@ cc_library(
 proto_lang_toolchain(
     name = "cc_toolchain",
     command_line = "--cpp_out=$(OUT)",
-    runtime = ":protobuf",
+    # runtime = ":protobuf",
     visibility = ["//visibility:public"],
 )
 
diff --git a/third_party/xla/third_party/tsl/tsl/platform/default/build_config.bzl b/third_party/xla/third_party/tsl/tsl/platform/default/build_config.bzl
index 3fe7b206..b2fb5677 100644
--- a/third_party/xla/third_party/tsl/tsl/platform/default/build_config.bzl
+++ b/third_party/xla/third_party/tsl/tsl/platform/default/build_config.bzl
@@ -401,10 +401,7 @@ def py_proto_library(
 
     genproto_deps = []
     for dep in deps:
-        if dep != "@com_google_protobuf//:protobuf_python":
-            genproto_deps.append(dep + "_genproto")
-        else:
-            genproto_deps.append("@com_google_protobuf//:well_known_types_py_pb2_genproto")
+        genproto_deps.append(dep + "_genproto")
 
     proto_gen(
         name = name + "_genproto",
-- 
2.30.2

