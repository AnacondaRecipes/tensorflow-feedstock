From 3d8def3597888d897b5f4bac0d76ead83a1f2a05 Mon Sep 17 00:00:00 2001
From: Jinzhe Zeng <jinzhe.zeng@rutgers.edu>
Date: Fri, 30 Jun 2023 19:00:49 -0400
Subject: [PATCH] add missing macro for CUDA_VERSION

---
 tensorflow/compiler/xla/stream_executor/cuda/cuda_graph.cc | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/tensorflow/compiler/xla/stream_executor/cuda/cuda_graph.cc b/tensorflow/compiler/xla/stream_executor/cuda/cuda_graph.cc
index 45eb8220d04..b0063383575 100644
--- a/tensorflow/compiler/xla/stream_executor/cuda/cuda_graph.cc
+++ b/tensorflow/compiler/xla/stream_executor/cuda/cuda_graph.cc
@@ -123,6 +123,7 @@ tsl::StatusOr<OwnedCudaGraph> CaptureCudaGraph(
 
   VLOG(5) << "Captured CUDA graph " << graph;
 
+#if CUDA_VERSION >= 12000
   // If verbose logging is enabled print captured CUDA graph debug information.
   if (VLOG_IS_ON(100)) {
     if (const char* path = getenv("XLA_CUDA_GRAPH_DEBUG_DIRECTORY"); path) {
@@ -153,6 +154,7 @@ tsl::StatusOr<OwnedCudaGraph> CaptureCudaGraph(
       }
     }
   }
+#endif  // CUDA_VERSION >= 12000
 
   return OwnedCudaGraph(graph);
 }
-- 
2.38.1

