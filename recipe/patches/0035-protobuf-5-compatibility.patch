From 2f1b6326913073fb1c95f952020ffaf66b1a16ad Mon Sep 17 00:00:00 2001
From: Eric Lundby <Eric.Lundby@gmail.com>
Date: Mon, 9 Jun 2025 14:35:48 -0600
Subject: [PATCH 1/1] protobuf-5-compatibility

---
 tensorflow/core/data/service/data_transfer_test.cc  | 2 +-
 tensorflow/core/data/service/snapshot/utils_test.cc | 4 ++--
 tensorflow/core/kernels/example_parsing_ops.cc      | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/tensorflow/core/data/service/data_transfer_test.cc b/tensorflow/core/data/service/data_transfer_test.cc
index d07623f6b53..1ec9033fa4c 100644
--- a/tensorflow/core/data/service/data_transfer_test.cc
+++ b/tensorflow/core/data/service/data_transfer_test.cc
@@ -85,7 +85,7 @@ TEST(DataTransferTest, EstimateVariantMemoryUsageBytes) {
   const size_t data_size = 1000;
 
   std::unique_ptr<CompressedElement> compressed{
-      protobuf::Arena::Create<CompressedElement>(nullptr)};
+      google::protobuf::Arena::CreateMessage<CompressedElement>(nullptr)};
   compressed->set_data(std::string(data_size, 'a'));
 
   Tensor tensor(DT_VARIANT, TensorShape({}));
diff --git a/tensorflow/core/data/service/snapshot/utils_test.cc b/tensorflow/core/data/service/snapshot/utils_test.cc
index 03350f68ccc..8fba7355749 100644
--- a/tensorflow/core/data/service/snapshot/utils_test.cc
+++ b/tensorflow/core/data/service/snapshot/utils_test.cc
@@ -44,7 +44,7 @@ TEST(UtilsTest, EstimatedSizeBytes) {
 TEST(UtilsTest, EstimatedVariantSizeBytes) {
   // Variant Tensor of size 1000.
   std::unique_ptr<CompressedElement> compressed{
-      protobuf::Arena::Create<CompressedElement>(nullptr)};
+      google::protobuf::Arena::CreateMessage<CompressedElement>(nullptr)};
   compressed->set_data(std::string(1000, 'a'));
   Tensor tensor(DT_VARIANT, TensorShape({}));
   tensor.scalar<Variant>()() = *compressed;
@@ -58,7 +58,7 @@ TEST(UtilsTest, EstimatedMixedElementsSizeBytes) {
 
   // Variant Tensor of size 1000.
   std::unique_ptr<CompressedElement> compressed{
-      protobuf::Arena::Create<CompressedElement>(nullptr)};
+      google::protobuf::Arena::CreateMessage<CompressedElement>(nullptr)};
   compressed->set_data(std::string(1000, 'a'));
   Tensor variant_tensor(DT_VARIANT, TensorShape({}));
   variant_tensor.scalar<Variant>()() = *compressed;
diff --git a/tensorflow/core/kernels/example_parsing_ops.cc b/tensorflow/core/kernels/example_parsing_ops.cc
index b7ea4c9f9bf..7b720369b27 100644
--- a/tensorflow/core/kernels/example_parsing_ops.cc
+++ b/tensorflow/core/kernels/example_parsing_ops.cc
@@ -965,7 +965,7 @@ class ParseSingleSequenceExampleOp : public OpKernel {
     options.start_block_size = std::max(options.start_block_size, block_size);
     options.max_block_size = std::max(options.max_block_size, block_size);
     protobuf::Arena arena(options);
-    auto& ex = *protobuf::Arena::Create<SequenceExample>(&arena);
+    auto& ex = *google::protobuf::Arena::CreateMessage<SequenceExample>(&arena);
 
     OP_REQUIRES(
         ctx, ParseProtoUnlimited(&ex, serialized_t()),
-- 
2.39.5 (Apple Git-154)

